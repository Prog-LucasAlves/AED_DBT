{"metadata": {"dbt_schema_version": "https://schemas.getdbt.com/dbt/run-results/v6.json", "dbt_version": "1.9.3", "generated_at": "2025-04-23T23:37:39.698684Z", "invocation_id": "1a9487b9-3b5c-41bc-8015-3d411e934cbd", "env": {}}, "results": [{"status": "success", "timing": [{"name": "compile", "started_at": "2025-04-23T23:36:23.772929Z", "completed_at": "2025-04-23T23:36:23.787947Z"}, {"name": "execute", "started_at": "2025-04-23T23:36:23.789030Z", "completed_at": "2025-04-23T23:36:26.124795Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 2.3548779487609863, "adapter_response": {"_message": "CREATE VIEW", "code": "CREATE VIEW", "rows_affected": -1}, "message": "CREATE VIEW", "failures": null, "unique_id": "model.meu_projeto_dbt.stg_canais_venda", "compiled": true, "compiled_code": "with\r\n    canais_venda as (\r\n        select\r\n            id_canal_venda,\r\n            descricao_canal_venda\r\n        from public_data.tb_canais_venda\r\n    )\r\n\r\nselect *\r\nfrom canais_venda", "relation_name": "\"dbt_q4iu\".\"public_staging\".\"stg_canais_venda\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-04-23T23:36:26.138845Z", "completed_at": "2025-04-23T23:36:26.142853Z"}, {"name": "execute", "started_at": "2025-04-23T23:36:26.143852Z", "completed_at": "2025-04-23T23:36:28.382697Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 2.247868537902832, "adapter_response": {"_message": "CREATE VIEW", "code": "CREATE VIEW", "rows_affected": -1}, "message": "CREATE VIEW", "failures": null, "unique_id": "model.meu_projeto_dbt.stg_categoria", "compiled": true, "compiled_code": "with\r\n    categoria as (\r\n        select\r\n            id_categoria,\r\n            descricao_categoria\r\n        from public_data.tb_categoria\r\n    )\r\n\r\nselect *\r\nfrom categoria", "relation_name": "\"dbt_q4iu\".\"public_staging\".\"stg_categoria\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-04-23T23:36:28.392274Z", "completed_at": "2025-04-23T23:36:28.397275Z"}, {"name": "execute", "started_at": "2025-04-23T23:36:28.398274Z", "completed_at": "2025-04-23T23:36:30.714102Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 2.3248283863067627, "adapter_response": {"_message": "CREATE VIEW", "code": "CREATE VIEW", "rows_affected": -1}, "message": "CREATE VIEW", "failures": null, "unique_id": "model.meu_projeto_dbt.stg_cliente", "compiled": true, "compiled_code": "with\r\n    cliente as (\r\n        select\r\n            id_cliente,\r\n            primeiro_nome,\r\n            sobrenome,\r\n            id_genero,\r\n            id_estado_civil,\r\n            data_nascimento,\r\n            cpf,\r\n            rg,\r\n            email,\r\n            telefone,\r\n            endereco,\r\n            id_estado,\r\n            id_email_marketing\r\n        from public_data.tb_cliente\r\n    )\r\n\r\nselect *\r\nfrom cliente", "relation_name": "\"dbt_q4iu\".\"public_staging\".\"stg_cliente\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-04-23T23:36:30.723166Z", "completed_at": "2025-04-23T23:36:30.726671Z"}, {"name": "execute", "started_at": "2025-04-23T23:36:30.726671Z", "completed_at": "2025-04-23T23:36:32.936688Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 2.217027187347412, "adapter_response": {"_message": "CREATE VIEW", "code": "CREATE VIEW", "rows_affected": -1}, "message": "CREATE VIEW", "failures": null, "unique_id": "model.meu_projeto_dbt.stg_email_marketing", "compiled": true, "compiled_code": "with\r\n    email_marketing as (\r\n        select\r\n            id_email_marketing,\r\n            descricao_email_marketing\r\n        from public_data.tb_email_marketing\r\n    )\r\n\r\nselect *\r\nfrom email_marketing", "relation_name": "\"dbt_q4iu\".\"public_staging\".\"stg_email_marketing\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-04-23T23:36:32.946712Z", "completed_at": "2025-04-23T23:36:32.952752Z"}, {"name": "execute", "started_at": "2025-04-23T23:36:32.954749Z", "completed_at": "2025-04-23T23:36:35.129944Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 2.186737537384033, "adapter_response": {"_message": "CREATE VIEW", "code": "CREATE VIEW", "rows_affected": -1}, "message": "CREATE VIEW", "failures": null, "unique_id": "model.meu_projeto_dbt.stg_estado", "compiled": true, "compiled_code": "with\r\n    estado as (\r\n        select\r\n            id_estado,\r\n            descricao_estado,\r\n            sigla_estado\r\n        from public_data.tb_estado\r\n    )\r\n\r\nselect *\r\nfrom estado", "relation_name": "\"dbt_q4iu\".\"public_staging\".\"stg_estado\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-04-23T23:36:35.138974Z", "completed_at": "2025-04-23T23:36:35.142489Z"}, {"name": "execute", "started_at": "2025-04-23T23:36:35.143489Z", "completed_at": "2025-04-23T23:36:37.515271Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 2.379812479019165, "adapter_response": {"_message": "CREATE VIEW", "code": "CREATE VIEW", "rows_affected": -1}, "message": "CREATE VIEW", "failures": null, "unique_id": "model.meu_projeto_dbt.stg_estado_civil", "compiled": true, "compiled_code": "with\r\n    estado_civil as (\r\n        select\r\n            id_estado_civil,\r\n            descricao_estado_civil\r\n        from public_data.tb_estado_civil\r\n    )\r\n\r\nselect *\r\nfrom estado_civil", "relation_name": "\"dbt_q4iu\".\"public_staging\".\"stg_estado_civil\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-04-23T23:36:37.523878Z", "completed_at": "2025-04-23T23:36:37.526879Z"}, {"name": "execute", "started_at": "2025-04-23T23:36:37.526879Z", "completed_at": "2025-04-23T23:36:39.803295Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 2.2824151515960693, "adapter_response": {"_message": "CREATE VIEW", "code": "CREATE VIEW", "rows_affected": -1}, "message": "CREATE VIEW", "failures": null, "unique_id": "model.meu_projeto_dbt.stg_formas_pagamento", "compiled": true, "compiled_code": "with\r\n    formas_pagamento as (\r\n        select\r\n            id_forma_pagamento,\r\n            descricao_metodo_pagamento\r\n        from public_data.tb_formas_pagamento\r\n    )\r\n\r\nselect *\r\nfrom formas_pagamento", "relation_name": "\"dbt_q4iu\".\"public_staging\".\"stg_formas_pagamento\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-04-23T23:36:39.812583Z", "completed_at": "2025-04-23T23:36:39.816583Z"}, {"name": "execute", "started_at": "2025-04-23T23:36:39.818090Z", "completed_at": "2025-04-23T23:36:42.000995Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 2.1919853687286377, "adapter_response": {"_message": "CREATE VIEW", "code": "CREATE VIEW", "rows_affected": -1}, "message": "CREATE VIEW", "failures": null, "unique_id": "model.meu_projeto_dbt.stg_genero", "compiled": true, "compiled_code": "with\r\n    genero as (\r\n        select\r\n            id_genero,\r\n            descricao_genero\r\n        from public_data.tb_genero\r\n    )\r\n\r\nselect *\r\nfrom genero", "relation_name": "\"dbt_q4iu\".\"public_staging\".\"stg_genero\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-04-23T23:36:42.015016Z", "completed_at": "2025-04-23T23:36:42.022045Z"}, {"name": "execute", "started_at": "2025-04-23T23:36:42.024045Z", "completed_at": "2025-04-23T23:36:44.234127Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 2.222111225128174, "adapter_response": {"_message": "CREATE VIEW", "code": "CREATE VIEW", "rows_affected": -1}, "message": "CREATE VIEW", "failures": null, "unique_id": "model.meu_projeto_dbt.stg_itens_pedido", "compiled": true, "compiled_code": "with\r\n    itens_pedido as (\r\n        select\r\n            id_item_produto,\r\n            id_pedido,\r\n            id_produto,\r\n            quantidade,\r\n            preco_unitario,\r\n            valor_subtotal\r\n        from public_data.tb_itens_pedido\r\n    )\r\n\r\nselect *\r\nfrom itens_pedido", "relation_name": "\"dbt_q4iu\".\"public_staging\".\"stg_itens_pedido\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-04-23T23:36:44.243685Z", "completed_at": "2025-04-23T23:36:44.249206Z"}, {"name": "execute", "started_at": "2025-04-23T23:36:44.251007Z", "completed_at": "2025-04-23T23:36:46.529183Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 2.2888100147247314, "adapter_response": {"_message": "CREATE VIEW", "code": "CREATE VIEW", "rows_affected": -1}, "message": "CREATE VIEW", "failures": null, "unique_id": "model.meu_projeto_dbt.stg_pedido", "compiled": true, "compiled_code": "with\r\n    pedido as (\r\n        select\r\n            id_pedido,\r\n            id_cliente,\r\n            id_forma_pagamento,\r\n            id_canal_venda,\r\n            id_status,\r\n            data_pedido,\r\n            subtotal,\r\n            frete,\r\n            total,\r\n            data_entrega\r\n        from public_data.tb_pedido\r\n    )\r\n\r\nselect *\r\nfrom pedido", "relation_name": "\"dbt_q4iu\".\"public_staging\".\"stg_pedido\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-04-23T23:36:46.543242Z", "completed_at": "2025-04-23T23:36:46.549253Z"}, {"name": "execute", "started_at": "2025-04-23T23:36:46.551268Z", "completed_at": "2025-04-23T23:36:48.900701Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 2.3610999584198, "adapter_response": {"_message": "CREATE VIEW", "code": "CREATE VIEW", "rows_affected": -1}, "message": "CREATE VIEW", "failures": null, "unique_id": "model.meu_projeto_dbt.stg_produto", "compiled": true, "compiled_code": "with\r\n    produto as (\r\n        select\r\n            id_produto,\r\n            descricao_produto,\r\n            id_categoria,\r\n            preco_unitario,\r\n            quantidade_estoque\r\n        from public_data.tb_produto\r\n    )\r\n\r\nselect *\r\nfrom produto", "relation_name": "\"dbt_q4iu\".\"public_staging\".\"stg_produto\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-04-23T23:36:48.909966Z", "completed_at": "2025-04-23T23:36:48.914966Z"}, {"name": "execute", "started_at": "2025-04-23T23:36:48.915966Z", "completed_at": "2025-04-23T23:36:51.124426Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 2.216468334197998, "adapter_response": {"_message": "CREATE VIEW", "code": "CREATE VIEW", "rows_affected": -1}, "message": "CREATE VIEW", "failures": null, "unique_id": "model.meu_projeto_dbt.stg_status", "compiled": true, "compiled_code": "with\r\n    status as (\r\n        select\r\n            id_status,\r\n            descricao_status\r\n        from public_data.tb_status\r\n    )\r\n\r\nselect *\r\nfrom status", "relation_name": "\"dbt_q4iu\".\"public_staging\".\"stg_status\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-04-23T23:36:51.141104Z", "completed_at": "2025-04-23T23:36:51.159051Z"}, {"name": "execute", "started_at": "2025-04-23T23:36:51.161073Z", "completed_at": "2025-04-23T23:36:57.762221Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 6.629173517227173, "adapter_response": {"_message": "SELECT 360000", "code": "SELECT", "rows_affected": 360000}, "message": "SELECT 360000", "failures": null, "unique_id": "model.meu_projeto_dbt.raw_pedido", "compiled": true, "compiled_code": "WITH pedido AS (\n    SELECT *\n    FROM \"dbt_q4iu\".\"public_staging\".\"stg_pedido\"\n    WHERE total > 0) -- Filtra pedidos com valOR maiOR que 0\n\nSELECT * FROM pedido", "relation_name": "\"dbt_q4iu\".\"public_raw\".\"raw_pedido\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-04-23T23:36:57.779238Z", "completed_at": "2025-04-23T23:36:57.795941Z"}, {"name": "execute", "started_at": "2025-04-23T23:36:57.798518Z", "completed_at": "2025-04-23T23:37:01.984356Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 4.209640026092529, "adapter_response": {"_message": "SELECT 71936", "code": "SELECT", "rows_affected": 71936}, "message": "SELECT 71936", "failures": null, "unique_id": "model.meu_projeto_dbt.raw_tempo_medio_entrega", "compiled": true, "compiled_code": "-- Modelo para calcular o tempo m\u00e9dio de entrega dos pedidos\nWITH tempo_medio_entrega AS (\n    SELECT\n        p.id_pedido,\n        p.data_pedido,\n        p.data_entrega,\n        (p.data_entrega - p.data_pedido)::INT AS tempo_entrega_dias\n    FROM \"dbt_q4iu\".\"public_staging\".\"stg_pedido\" p\n    WHERE p.data_entrega IS NOT NULL\n)\n\nSELECT * FROM tempo_medio_entrega", "relation_name": "\"dbt_q4iu\".\"public_raw\".\"raw_tempo_medio_entrega\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-04-23T23:37:01.998400Z", "completed_at": "2025-04-23T23:37:02.009436Z"}, {"name": "execute", "started_at": "2025-04-23T23:37:02.010436Z", "completed_at": "2025-04-23T23:37:12.890897Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 10.897501707077026, "adapter_response": {"_message": "SELECT 19", "code": "SELECT", "rows_affected": 19}, "message": "SELECT 19", "failures": null, "unique_id": "model.meu_projeto_dbt.raw_cliente_pedido_pendente", "compiled": true, "compiled_code": "-- Quantidade de pedidos 'Pendentes' por cliente ->> ultimos 7 dias\n-- Sugest\u00e3o aplicar um desconto de acordo com o valor total do pedido, conforme a regra abaixo:\n-- Se o valor total do pedido for maior que R$ 1.000,00, aplicar um desconto de 15%\n-- Se o valor total do pedido for maior que R$ 500,00, aplicar um desconto de 10%\n-- Se o valor total do pedido for menor ou igual a R$ 500,00, n\u00e3o aplicar desconto\n\n-- Enviar email para o cliente com os pedidos pendentes ->> ultimos 7 dias\n-- Sugest\u00e3o enviar email com os dados do pedido, incluindo o valor total com desconto e o percentual de desconto aplicado\n\nWITH cliente_pedido_pendente AS (\n    SELECT\n        c.id_cliente,\n        FIRST_VALUE(c.primeiro_nome) OVER (PARTITION BY c.id_cliente) AS primeiro_nome,\n        c.email,\n        p.id_pedido,\n        p.data_pedido,\n        p.total,\n        cv.descricao_canal_venda,\n        COUNT(it.id_produto) AS qtd_itens_pedido,\n        STRING_AGG(pr.descricao_produto, ',') AS produtos,\n\n        -- Aplica o desconto\n        CASE\n            WHEN p.total > 1000 THEN p.total * 0.85  -- Desconto de 15%\n            WHEN p.total > 500 THEN p.total * 0.9   -- Desconto de 10%\n            ELSE p.total\n        END AS total_com_desconto,\n\n        -- Indica qual desconto foi aplicado\n        CASE\n            WHEN p.total > 1000 THEN 15\n            WHEN p.total > 500 THEN 10\n            ELSE 0\n        END AS percentual_desconto,\n\n        -- Contagem de pedidos pendentes por cliente\n        COUNT(*) OVER (PARTITION BY c.id_cliente) AS qtd_pedidos_pendentes,\n\n        -- Soma total de descontos aplicados por cliente\n        SUM(\n            CASE\n                WHEN p.total > 1000 THEN p.total * 0.15\n                WHEN p.total > 500 THEN p.total * 0.10\n                ELSE 0\n            END\n        ) OVER (PARTITION BY c.id_cliente) AS valor_desconto\n\n    FROM \"dbt_q4iu\".\"public_staging\".\"stg_cliente\" c\n    INNER JOIN \"dbt_q4iu\".\"public_raw\".\"raw_pedido\" p\n        ON c.id_cliente = p.id_cliente\n    INNER JOIN \"dbt_q4iu\".\"public_staging\".\"stg_canais_venda\" cv\n        ON p.id_canal_venda = cv.id_canal_venda\n    INNER JOIN \"dbt_q4iu\".\"public_staging\".\"stg_itens_pedido\" it\n        ON p.id_pedido = it.id_pedido\n    INNER JOIN \"dbt_q4iu\".\"public_staging\".\"stg_produto\" pr\n        ON it.id_produto = pr.id_produto\n    WHERE p.id_status = 1\n    AND p.data_pedido >= CURRENT_DATE - INTERVAL '7 days'\n    GROUP BY\n        c.id_cliente, c.primeiro_nome, c.email,\n        p.id_pedido, p.data_pedido, p.total,\n        cv.descricao_canal_venda\n    )\nSELECT\n    id_cliente,\n    primeiro_nome,\n    email,\n    data_pedido,\n    id_pedido,\n    qtd_itens_pedido,\n    produtos,\n    'R$' || TO_CHAR(total, 'FM999G999G999D99') AS total,\n    percentual_desconto || '%' AS desconto,\n    'R$' || TO_CHAR(valor_desconto, 'FM999G999G999D99') AS valor_desconto,\n    'R$' || TO_CHAR(total_com_desconto, 'FM999G999G999D99') AS total_com_desconto,\n    'R$' || TO_CHAR(SUM(total_com_desconto) OVER (ORDER BY id_cliente), 'FM999G999G999D99') AS soma_acumulada,\n    descricao_canal_venda,\n    qtd_pedidos_pendentes\nFROM cliente_pedido_pendente\nORDER BY id_cliente, id_pedido", "relation_name": "\"dbt_q4iu\".\"public_raw\".\"raw_cliente_pedido_pendente\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-04-23T23:37:12.903414Z", "completed_at": "2025-04-23T23:37:12.910936Z"}, {"name": "execute", "started_at": "2025-04-23T23:37:12.911934Z", "completed_at": "2025-04-23T23:37:17.442985Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 4.543574810028076, "adapter_response": {"_message": "SELECT 97", "code": "SELECT", "rows_affected": 97}, "message": "SELECT 97", "failures": null, "unique_id": "model.meu_projeto_dbt.raw_faturamento_mensal", "compiled": true, "compiled_code": "-- Faturamento mensal com formata\u00e7\u00e3o de moeda e total acumulado\nWITH\n    faturamento_mensal AS (\n        SELECT\n            to_char(date_trunc('month', data_pedido), 'YYYY-MM') AS mes, -- Formata\u00e7\u00e3o para o m\u00eas e ano\n            'R$ ' || to_char(sum(total), 'FM999G999G999D99') AS total_faturado, -- Formata\u00e7\u00e3o para o total do m\u00eas\n            'R$ ' || to_char(sum(sum(total)) OVER (\n                                        ORDER BY date_trunc('month', data_pedido)), 'FM999G999G999D99') AS total_faturado_acumulado\n        FROM \"dbt_q4iu\".\"public_raw\".\"raw_pedido\"\n        GROUP BY date_trunc('month', data_pedido) -- Agrupamento por m\u00eas\n        ORDER BY mes\n    )\n\nSELECT * FROM faturamento_mensal", "relation_name": "\"dbt_q4iu\".\"public_raw\".\"raw_faturamento_mensal\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-04-23T23:37:17.453019Z", "completed_at": "2025-04-23T23:37:17.459084Z"}, {"name": "execute", "started_at": "2025-04-23T23:37:17.459084Z", "completed_at": "2025-04-23T23:37:26.170538Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 8.720524311065674, "adapter_response": {"_message": "SELECT 47456", "code": "SELECT", "rows_affected": 47456}, "message": "SELECT 47456", "failures": null, "unique_id": "model.meu_projeto_dbt.raw_ticket_medio_cliente", "compiled": true, "compiled_code": "-- Total de pedidos e ticket medio por cliente com status de entrega como ENTREGUE\nWITH \n    ticket_medio_por_cliente AS(\n        SELECT\n            c.id_cliente,\n            c.primeiro_nome,\n            c.email,\n            c.telefone,\n            count(p.id_pedido) AS qtd_pedidos, -- Total de pedidos\n            round(cast(avg(p.total) AS numeric), 2) AS ticket_medio -- Ticket m\u00e9sio\n\n        FROM \"dbt_q4iu\".\"public_staging\".\"stg_cliente\" c\n        LEFT JOIN \"dbt_q4iu\".\"public_raw\".\"raw_pedido\" p ON c.id_cliente = p.id_cliente\n        WHERE p.id_status = 4 -- Filtrando por status de entrega como ENTREGUE\n\n        GROUP BY c.id_cliente,\n                 c.primeiro_nome,\n                 c.email,\n                 c.telefone -- Agrupando por id_cliente, primeiro_nome, email, telefone\n)\nSELECT\n    id_cliente,\n    primeiro_nome,\n    email,\n    telefone,\n    qtd_pedidos,\n    'R$' || TO_CHAR(ticket_medio, 'FM999G999G999D99') AS ticket_medio -- Formata o total para moeda brasileira\nFROM ticket_medio_por_cliente\nWHERE ticket_medio IS NOT NULL -- Filtrando por ticket_medio n\u00e3o nulo\nORDER BY id_cliente ASC -- Ordenando por ticket_medio em ordem decrescente", "relation_name": "\"dbt_q4iu\".\"public_raw\".\"raw_ticket_medio_cliente\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-04-23T23:37:26.179091Z", "completed_at": "2025-04-23T23:37:26.184665Z"}, {"name": "execute", "started_at": "2025-04-23T23:37:26.186692Z", "completed_at": "2025-04-23T23:37:32.304230Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 6.128161907196045, "adapter_response": {"_message": "SELECT 6", "code": "SELECT", "rows_affected": 6}, "message": "SELECT 6", "failures": null, "unique_id": "model.meu_projeto_dbt.raw_valor_total_canal_venda", "compiled": true, "compiled_code": "-- Modelo para calcular o valor total por canal de venda\nWITH\n    total_por_canal_venda AS (\n        SELECT\n            cv.descricao_canal_venda,\n            SUM(p.total) AS total -- Total por canal de venda\n        FROM \"dbt_q4iu\".\"public_raw\".\"raw_pedido\" p\n        JOIN \"dbt_q4iu\".\"public_staging\".\"stg_canais_venda\" cv ON p.id_canal_venda = cv.id_canal_venda\n        GROUP BY cv.descricao_canal_venda\n    )\n\nSELECT\n    descricao_canal_venda,\n    to_char(total, 'L999G999G999D99') AS total_formatado, -- Formata o total com s\u00edmbolo de moeda\n    ROUND((total * 100.0 / nullif(\n        (SELECT SUM(total)\n        FROM total_por_canal_venda), 0))::numeric, 2) AS percentual -- Percentual do total\nFROM total_por_canal_venda\nORDER BY total DESC -- Ordenar por total decrescente", "relation_name": "\"dbt_q4iu\".\"public_raw\".\"raw_valor_total_canal_venda\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-04-23T23:37:32.312258Z", "completed_at": "2025-04-23T23:37:32.318774Z"}, {"name": "execute", "started_at": "2025-04-23T23:37:32.319778Z", "completed_at": "2025-04-23T23:37:37.991527Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 5.682270526885986, "adapter_response": {"_message": "SELECT 5", "code": "SELECT", "rows_affected": 5}, "message": "SELECT 5", "failures": null, "unique_id": "model.meu_projeto_dbt.raw_valor_total_forma_pagamento", "compiled": true, "compiled_code": "-- Modelo para calcular o valor total por forma de pagamento\nWITH\n    total_por_forma_pagamento AS(\n        SELECT\n            fp.descricao_metodo_pagamento,\n            sum(p.total) AS total -- Calcula o total por forma de pagamento\n        FROM \"dbt_q4iu\".\"public_raw\".\"raw_pedido\" p\n        JOIN \"dbt_q4iu\".\"public_staging\".\"stg_formas_pagamento\" fp ON p.id_forma_pagamento = fp.id_forma_pagamento\n        GROUP BY fp.descricao_metodo_pagamento\n    )\nSELECT\n    descricao_metodo_pagamento,\n    'R$' || to_char(total, 'FM999G999G999D99') AS total_formatado, -- Formata o total para moeda brasileira\n    round((total * 100.0 /\n                (SELECT sum(total)\n                 FROM total_por_forma_pagamento))::numeric, 2) AS percentual -- Calcula o percentual de cada forma de pagamento\nFROM total_por_forma_pagamento\nORDER BY total DESC -- Ordena os resultados por total decrescente", "relation_name": "\"dbt_q4iu\".\"public_raw\".\"raw_valor_total_forma_pagamento\"", "batch_results": null}], "elapsed_time": 88.83577036857605, "args": {"printer_width": 80, "log_level": "info", "use_colors_file": true, "print": true, "use_colors": true, "introspect": true, "require_batched_execution_for_custom_microbatch_strategy": false, "empty": false, "show_resource_report": false, "static_parser": true, "vars": {}, "log_format_file": "debug", "profiles_dir": "C:\\Users\\Lucas\\.dbt", "exclude": [], "which": "run", "write_json": true, "log_path": "D:\\Prjts\\AED_DBT\\dbt_project\\logs", "source_freshness_run_project_hooks": false, "cache_selected_only": false, "require_yaml_configuration_for_mf_time_spines": false, "partial_parse": true, "send_anonymous_usage_stats": true, "invocation_command": "dbt run", "log_level_file": "debug", "warn_error_options": {"include": [], "exclude": []}, "require_nested_cumulative_type_params": false, "partial_parse_file_diff": true, "log_format": "default", "log_file_max_bytes": 10485760, "require_explicit_package_overrides_for_builtin_materializations": true, "state_modified_compare_vars": false, "skip_nodes_if_on_run_start_fails": false, "select": [], "quiet": false, "defer": false, "indirect_selection": "eager", "strict_mode": false, "project_dir": "D:\\Prjts\\AED_DBT\\dbt_project", "state_modified_compare_more_unrendered_values": false, "require_resource_names_without_spaces": false, "populate_cache": true, "favor_state": false, "macro_debugging": false, "version_check": true}}
